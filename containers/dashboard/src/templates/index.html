{% extends base %} {% block content %}
<div
  id="dashboard-content"
  hx-get="/dashboard"
  hx-trigger="every {{ auto_refresh_interval }}s"
  hx-swap="outerHTML"
>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- CPU Card -->
    <div
      class="glass-panel p-5 rounded-2xl shadow-lg relative overflow-hidden group"
    >
      <div
        class="absolute -right-4 -top-4 w-24 h-24 bg-silva-500/10 rounded-full blur-xl group-hover:bg-silva-500/20 transition-all"
      ></div>

      <div
        class="text-xs font-bold text-gray-400 uppercase tracking-wider flex justify-between relative z-10"
      >
        <span>CPU Usage</span>
        <span class="text-silva-400 font-mono">{{ stats.cpu_temp }}</span>
      </div>

      <div class="mt-3 grid grid-cols-4 gap-1 relative z-10 h-10 items-end">
        {% for core in stats.cpu_cores %}
        <div
          class="h-full bg-gray-200 dark:bg-gray-700/50 rounded-sm overflow-hidden flex flex-col justify-end w-full"
          title="Core {{ loop.index }}: {{ core }}%"
        >
          <div
            class="bg-gradient-to-t from-silva-500 to-silva-400 w-full"
            style="height: {{ core }}%"
          ></div>
        </div>
        {% endfor %}
      </div>
      <div class="text-right text-[10px] text-gray-500 mt-1 font-mono">
        Avg: {{ stats.cpu }}%
      </div>
    </div>

    <!-- RAM Card -->
    <div
      class="glass-panel p-5 rounded-2xl shadow-lg relative overflow-hidden group"
    >
      <div
        class="absolute -right-4 -top-4 w-24 h-24 bg-blue-500/10 rounded-full blur-xl group-hover:bg-blue-500/20 transition-all"
      ></div>
      <div
        class="text-xs font-bold text-gray-400 uppercase tracking-wider relative z-10"
      >
        RAM Usage
      </div>
      <div
        class="text-2xl font-heading font-bold text-gray-900 dark:text-white mt-3 relative z-10"
      >
        {{ stats.ram_used_gb }}<span
          class="text-sm text-gray-500 font-normal mx-1"
          >/</span
        >{{ stats.ram_total_gb }}
        <span class="text-sm text-gray-500 font-normal">GB</span>
      </div>
      <div
        class="w-full bg-gray-200 dark:bg-gray-700/50 h-1.5 mt-5 rounded-full overflow-hidden"
      >
        <div
          class="bg-gradient-to-r from-blue-500 to-cyan-400 h-full rounded-full transition-all duration-1000 ease-out"
          style="width: {{ stats.ram_percent }}%"
        ></div>
      </div>
    </div>

    <!-- Disk Card -->
    <div
      class="glass-panel p-5 rounded-2xl shadow-lg relative overflow-hidden group"
    >
      <div
        class="absolute -right-4 -top-4 w-24 h-24 bg-purple-500/10 rounded-full blur-xl group-hover:bg-purple-500/20 transition-all"
      ></div>
      <div
        class="text-xs font-bold text-gray-400 uppercase tracking-wider relative z-10"
      >
        SSD STORAGE
      </div>
      <div
        class="text-2xl font-heading font-bold text-gray-900 dark:text-white mt-3 relative z-10"
      >
        {{ stats.disk_used_gb }}<span
          class="text-sm text-gray-500 font-normal mx-1"
          >/</span
        >{{ stats.disk_total_gb }}
        <span class="text-sm text-gray-500 font-normal">GB</span>
      </div>
      <div
        class="w-full bg-gray-200 dark:bg-gray-700/50 h-1.5 mt-5 rounded-full overflow-hidden relative z-10"
      >
        <div
          class="bg-gradient-to-r from-purple-500 to-pink-400 h-full rounded-full transition-all duration-1000 ease-out"
          style="width: {{ stats.disk_percent }}%"
        ></div>
      </div>
    </div>

    <!-- Last Recording Card -->
    <div
      class="glass-panel p-5 rounded-2xl shadow-lg relative overflow-hidden group"
    >
      <div
        class="absolute -right-4 -top-4 w-24 h-24 bg-amber-500/10 rounded-full blur-xl group-hover:bg-amber-500/20 transition-all"
      ></div>
      <div
        class="text-xs font-bold text-gray-400 uppercase tracking-wider relative z-10"
      >
        Last Recording
      </div>
      <div
        class="text-3xl font-heading font-bold text-gray-900 dark:text-white mt-3 truncate relative z-10"
      >
        {{ stats.last_recording }}
      </div>
      <div class="text-xs text-silva-500 mt-2 font-bold relative z-10">
        {% if stats.last_recording_ago >= 0 %} {{ stats.last_recording_ago }}s
        ago {% else %} -- {% endif %}
      </div>
    </div>
  </div>

  <!-- Throughput Analysis -->
  <div
    class="glass-panel p-5 rounded-2xl shadow-lg relative overflow-hidden group md:col-span-2 lg:col-span-4"
  >
    <div class="flex items-center justify-between mb-4">
      <div
        class="text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2"
      >
        <svg
          class="w-4 h-4 text-blue-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 10V3L4 14h7v7l9-11h-7z"
          ></path>
        </svg>
        Processing Status
      </div>
      <div class="text-[10px] font-mono text-gray-400">Live Backlog</div>
    </div>

    <!-- Visualization Parallel Flow -->
    <div
      class="flex flex-col md:flex-row items-center justify-around relative gap-8 md:gap-0"
    >
      <!-- Source: Recorder -->
      <div
        class="flex flex-col items-center group/item relative z-10 w-full md:w-1/3"
      >
        <div
          class="p-3 bg-gray-100 dark:bg-white/10 rounded-full mb-2 group-hover/item:scale-110 transition-transform shadow-lg border border-transparent {% if throughput.recorder_active %}border-green-500/50{% else %}border-gray-500/30{% endif %}"
        >
          <!-- Neural Mic Icon -->
          <svg
            class="w-6 h-6 text-gray-700 dark:text-gray-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
            ></path>
          </svg>
        </div>
        <div class="text-sm font-bold text-gray-700 dark:text-gray-200">
          Recorder
        </div>

        {% if throughput.recorder_active %}
        <div class="text-[10px] text-green-500 font-bold mt-1 animate-pulse">
          ACTIVE
        </div>
        {% else %}
        <div class="text-[10px] text-gray-400 font-bold mt-1">IDLE</div>
        {% endif %}
      </div>

      <!-- Splitter / Arrows -->
      <div class="hidden md:flex flex-col justify-center h-24 w-1/6 relative">
        <!-- Top Branch Arrow -->
        <div
          class="h-10 border-l-2 border-t-2 border-gray-200 dark:border-gray-700 rounded-tl-xl absolute top-0 left-0 w-full translate-y-2"
        ></div>

        <!-- Bottom Branch Arrow -->
        <div
          class="h-10 border-l-2 border-b-2 border-gray-200 dark:border-gray-700 rounded-bl-xl absolute bottom-0 left-0 w-full -translate-y-2"
        ></div>

        <!-- Animated Dots for Flow -->
        <div
          class="absolute inset-0 flex items-center justify-center opacity-30"
        >
          <div class="w-1 h-1 bg-blue-500 rounded-full animate-ping"></div>
        </div>
      </div>

      <!-- Consumers Stack -->
      <div class="flex flex-col gap-4 w-full md:w-1/3">
        <!-- Analyzer Row -->
        <div class="flex items-center gap-3">
          <!-- Arrow Head -->
          <div class="text-gray-200 dark:text-gray-700">‚ñ∂</div>

          <!-- Analyzer Block -->
          <div
            class="flex items-center gap-3 p-2 rounded-xl bg-gray-50/50 dark:bg-white/5 flex-1 relative overflow-hidden group/consumer border border-transparent {% if throughput.analyzer_status == 'ok' %}hover:border-green-500/30{% endif %}"
          >
            <!-- Shimmer bg -->
            <div
              class="absolute inset-0 bg-gradient-to-r from-transparent via-blue-500/5 to-transparent translate-x-[-100%] animate-[shimmer_3s_infinite]"
            ></div>

            <div class="p-2 bg-white dark:bg-white/10 rounded-lg shadow-sm">
              <svg
                class="w-4 h-4 text-gray-700 dark:text-gray-200"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"
                ></path>
              </svg>
            </div>

            <div class="flex flex-col">
              <span class="text-xs font-bold text-gray-700 dark:text-gray-200"
                >Analyzer</span
              >
              {% if throughput.analyzer_status == 'ok' %}
              <span class="text-[10px] text-green-500 font-bold">SYNCED</span>
              {% elif throughput.analyzer_status == 'pending' %}
              <span class="text-[10px] text-blue-400 font-bold"
                >{{ throughput.analyzer_lag }} PENDING</span
              >
              {% else %}
              <span class="text-[10px] text-amber-500 font-bold"
                >LAG: {{ throughput.analyzer_lag }}</span
              >
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Uploader Row -->
        <div class="flex items-center gap-3">
          <!-- Arrow Head -->
          <div class="text-gray-200 dark:text-gray-700">‚ñ∂</div>

          <!-- Uploader Block -->
          <div
            class="flex items-center gap-3 p-2 rounded-xl bg-gray-50/50 dark:bg-white/5 flex-1 relative overflow-hidden group/consumer border border-transparent {% if throughput.uploader_status == 'ok' %}hover:border-green-500/30{% endif %}"
          >
            <!-- Shimmer bg -->
            <div
              class="absolute inset-0 bg-gradient-to-r from-transparent via-cyan-500/5 to-transparent translate-x-[-100%] animate-[shimmer_3s_infinite] delay-75"
            ></div>

            <div class="p-2 bg-white dark:bg-white/10 rounded-lg shadow-sm">
              <svg
                class="w-4 h-4 text-gray-700 dark:text-gray-200"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                ></path>
              </svg>
            </div>

            <div class="flex flex-col">
              <span class="text-xs font-bold text-gray-700 dark:text-gray-200"
                >Uploader</span
              >
              {% if throughput.uploader_status == 'ok' %}
              <span class="text-[10px] text-green-500 font-bold">SYNCED</span>
              {% elif throughput.uploader_status == 'pending' %}
              <span class="text-[10px] text-blue-400 font-bold"
                >{{ throughput.uploader_lag }} PENDING</span
              >
              {% else %}
              <span class="text-[10px] text-amber-500 font-bold"
                >LAG: {{ throughput.uploader_lag }}</span
              >
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <h2
    class="text-xl font-heading font-bold mb-6 text-gray-900 dark:text-white flex items-center gap-3"
  >
    <span class="text-2xl">üê¶</span> Recent Detections
  </h2>

  <div
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4"
  >
    {% for d in detections %}
    <div
      class="group relative bg-white dark:bg-white/5 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-all border border-gray-200 dark:border-white/5 flex flex-col"
    >
      <!-- Image / Placeholder -->
      <div
        class="h-32 w-full bg-gray-100 dark:bg-gray-800 relative overflow-hidden"
      >
        {% if d.image_url %}
        <img
          src="{{ d.image_url }}"
          alt="{{ d.display_name }}"
          class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500"
        />
        {% else %}
        <div
          class="flex items-center justify-center h-full text-silva-200 dark:text-gray-700"
        >
          <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"
            />
          </svg>
        </div>
        {% endif %}

        <!-- Confidence Badge -->
        <div
          class="absolute top-2 right-2 px-2 py-0.5 rounded-full bg-black/60 backdrop-blur-md border border-white/10 text-[10px] font-bold text-white shadow-sm"
        >
          {{ (d.confidence * 100)|round(0)|int }}%
        </div>

        <!-- Play Overlay -->
        <div
          class="absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity"
        >
          <button
            class="p-2 bg-white/20 backdrop-blur-md rounded-full text-white hover:bg-white/40 transition hover:scale-105"
            onclick='playGlobalAudio("{{ d.audio_relative_path|replace("\\", "/") }}", "{{ d.display_name|replace("\"", "\\\"") }}", "{{ d.confidence }}")'
          >
            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z" />
            </svg>
          </button>
        </div>
      </div>

      <div class="p-4 flex flex-col flex-1 relative">
        <h3
          class="font-bold text-gray-900 dark:text-white text-sm truncate"
          title="{{ d.display_name }}"
        >
          {{ d.display_name }}
        </h3>
        <p class="text-[10px] text-gray-500 italic mb-2 truncate">
          {{ d.sci_name }}
        </p>

        <div
          class="mt-auto flex items-center justify-between pt-2 border-t border-gray-100 dark:border-white/5"
        >
          <div class="flex flex-col">
            <span
              class="local-date text-[10px] font-mono text-gray-400"
              data-timestamp="{{ d.iso_timestamp }}"
              >--</span
            >
            <span
              class="local-time-only text-[10px] font-mono text-gray-300"
              data-timestamp="{{ d.iso_timestamp }}"
              >--</span
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %} {% if not detections %}
    <div
      class="col-span-full p-10 text-center text-gray-500 italic bg-gray-50/50 dark:bg-white/5 rounded-2xl border border-dashed border-gray-300 dark:border-gray-700"
    >
      No recent detections found. Wait for the birds to sing! üê¶
    </div>
    {% endif %}
  </div>
</div>
{% endblock %} {% block inspector %}
<div class="space-y-6">
  <!-- System Health -->
  <div class="glass-panel p-6 rounded-2xl">
    <h3
      class="font-bold text-gray-900 dark:text-white mb-4 border-b border-gray-200 dark:border-white/10 pb-2 text-sm uppercase tracking-wide"
    >
      System Overview
    </h3>
    <div class="space-y-3">
      {% for c in containers %}
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div
            class="w-1.5 h-1.5 rounded-full {% if c.status == 'Running' %}bg-green-500{% elif c.status == 'Warning' %}bg-amber-500{% else %}bg-red-500{% endif %}"
          ></div>
          <span class="text-xs font-bold text-gray-600 dark:text-gray-300"
            >{{ c.display_name }}</span
          >
        </div>
        <span class="text-[10px] text-gray-400 font-mono">{{ c.status }}</span>
      </div>
      {% endfor %}
    </div>
    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-white/5">
      <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">
        SSD Storage
      </h4>
      <div
        class="w-full bg-gray-200 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden"
      >
        <div
          class="bg-gray-500 h-full rounded-full"
          style="width: {{ stats.disk_percent }}%"
        ></div>
      </div>
      <div class="flex justify-between text-[10px] text-gray-400 mt-1">
        <span>Used: {{ stats.disk_used_gb }} GB</span>
        <span>Total: {{ stats.disk_total_gb }} GB</span>
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="glass-panel p-6 rounded-2xl">
    <h3
      class="font-heading font-bold text-gray-900 dark:text-white mb-4 border-b border-gray-200 dark:border-white/10 pb-2 text-sm uppercase tracking-wide"
    >
      Bird BIO Stats
    </h3>
    <div class="space-y-4">
      <div class="flex justify-between items-center group">
        <span class="text-sm text-gray-400 group-hover:text-gray-300 transition"
          >Total Birds</span
        >
        <span class="font-mono font-bold text-lg text-blue-500"
          >{{ birdnet_stats.total }}</span
        >
      </div>
      <div class="flex justify-between items-center group">
        <span class="text-sm text-gray-400 group-hover:text-gray-300 transition"
          >Unique Species</span
        >
        <span class="font-mono font-bold text-lg text-green-500"
          >{{ birdnet_stats.species_count }}</span
        >
      </div>
      <div class="flex justify-between items-center group">
        <span
          class="text-sm text-gray-400 group-hover:text-gray-300 transition"
          title="Menhinick's Index (S / ‚àöN)"
          >Biodiversity</span
        >
        <span class="font-mono font-bold text-lg text-amber-500"
          >{{ birdnet_stats.biodiversity }}</span
        >
      </div>
    </div>
  </div>
</div>
{% endblock %}
