{% extends "base.html" %} {% block content %}
<h2 class="text-2xl font-bold mb-6 text-silva-100">BirdNET Detections</h2>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
  <!-- Stats Panel -->
  <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
    <h3 class="font-bold text-gray-400 uppercase text-xs mb-4">
      Top Species (All Time)
    </h3>
    <div class="space-y-3">
      {% for s in stats.top_species %}
      <div class="flex items-center justify-between">
        <span class="font-bold text-white">{{ s.com_name }}</span>
        <span class="bg-gray-700 text-green-400 px-2 py-1 rounded text-xs"
          >{{ s.count }}</span
        >
      </div>
      <div class="w-full bg-gray-700 h-1 rounded-full overflow-hidden">
        <div
          class="bg-green-500 h-full"
          style="width: {{ (s.count / stats.total * 100)|round }}%"
        ></div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Browser Table (Similar to Home but maybe paginated/filterable in future) -->
<!-- For now, showing expanded list -->
<div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
  <!-- Reuse table structure or component -->
  <table class="w-full text-left text-sm">
    <thead class="bg-gray-750 text-gray-400 uppercase font-bold text-xs">
      <tr>
        <th class="p-4">Date</th>
        <th class="p-4">Time</th>
        <th class="p-4">Species</th>
        <th class="p-4">Conf</th>
        <th class="p-4">Play</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-700">
      {% for d in detections %}
      <tr class="hover:bg-gray-700 transition">
        <td class="p-4 text-gray-400">{{ d.date }}</td>
        <td class="p-4 font-mono text-gray-400">{{ d.time }}</td>
        <td class="p-4 font-bold text-white">{{ d.com_name }}</td>
        <td class="p-4 text-green-400">{{ (d.confidence * 100)|round }}%</td>
        <td class="p-4">
          <!-- HTMX swap to inspector -->
          <button
            class="text-blue-400 hover:text-blue-300"
            onclick="playAudio('{{ d.filename }}', '{{ d.com_name }}', '{{ d.confidence }}')"
          >
            Play
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function playAudio(filename, name, conf) {
    const player = document.getElementById("main-player");
    const label = document.getElementById("player-label");
    const source = document.getElementById("audio-source");

    // Update src
    player.src = `/api/audio/${filename}`;
    label.innerText = `${name} (${Math.round(conf * 100)}%)`;

    player.parentElement.classList.remove("hidden");
    player.play();
  }
</script>
{% endblock %} {% block inspector %}
<div class="p-4 space-y-6">
  <div
    id="player-container"
    class="bg-gray-700/50 p-4 rounded-lg border border-gray-600 hidden"
  >
    <h3 class="font-bold text-green-400 mb-1">Now Playing</h3>
    <div id="player-label" class="text-white font-bold text-sm mb-4">
      Select a clip
    </div>
    <audio id="main-player" controls class="w-full"></audio>
  </div>

  <!-- Filters placeholder -->
  <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
    <h3 class="font-bold text-gray-400 uppercase text-xs mb-4">Filter</h3>
    <input
      type="text"
      placeholder="Search species..."
      class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-sm text-white focus:border-green-500 outline-none mb-2"
    />
    <input
      type="date"
      class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-sm text-white focus:border-green-500 outline-none"
    />
    <button
      class="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-2 rounded mt-4 text-sm"
    >
      Apply
    </button>
  </div>
</div>
{% endblock %}
