{% extends base %} {% block content %}
<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-heading font-bold text-gray-900 dark:text-white">
        Weather
      </h1>
      <p class="text-gray-500 dark:text-gray-400 mt-1">
        Local conditions from DWD Station {{ current.station_id if current else
        'Unknown' }}
      </p>
    </div>
    <div
      class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/50 dark:bg-white/5 border border-gray-200 dark:border-white/10"
    >
      <div
        class="w-2 h-2 rounded-full {{ 'bg-green-500 animate-pulse' if status_value == 'Running' else 'bg-red-500' }}"
      ></div>
      <span class="text-xs font-mono font-medium {{ status_color }}"
        >{{ status_value }}</span
      >
    </div>
  </div>

  <!-- Current Conditions Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Temperature -->
    <div
      class="glass-panel p-6 rounded-2xl border border-gray-200 dark:border-white/5 relative overflow-hidden group"
    >
      <div
        class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
      >
        <span class="text-6xl">üå°Ô∏è</span>
      </div>
      <div class="relative z-10">
        <div
          class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1"
        >
          Temperature
        </div>
        <div class="text-3xl font-bold text-gray-900 dark:text-white">
          {% if current %}{{ "%.1f"|format(current.temperature_c) }}¬∞C{% else
          %}--{% endif %}
        </div>
      </div>
    </div>

    <!-- Humidity -->
    <div
      class="glass-panel p-6 rounded-2xl border border-gray-200 dark:border-white/5 relative overflow-hidden group"
    >
      <div
        class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
      >
        <span class="text-6xl">üíß</span>
      </div>
      <div class="relative z-10">
        <div
          class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1"
        >
          Humidity
        </div>
        <div class="text-3xl font-bold text-gray-900 dark:text-white">
          {% if current %}{{ "%.1f"|format(current.humidity_percent) }}%{% else
          %}--{% endif %}
        </div>
      </div>
    </div>

    <!-- Precipitation -->
    <div
      class="glass-panel p-6 rounded-2xl border border-gray-200 dark:border-white/5 relative overflow-hidden group"
    >
      <div
        class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
      >
        <span class="text-6xl">‚òî</span>
      </div>
      <div class="relative z-10">
        <div
          class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1"
        >
          Rain (10m)
        </div>
        <div class="text-3xl font-bold text-gray-900 dark:text-white">
          {% if current %}{{ "%.1f"|format(current.precipitation_mm) }} mm{%
          else %}--{% endif %}
        </div>
      </div>
    </div>

    <!-- Wind -->
    <div
      class="glass-panel p-6 rounded-2xl border border-gray-200 dark:border-white/5 relative overflow-hidden group"
    >
      <div
        class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
      >
        <span class="text-6xl">üí®</span>
      </div>
      <div class="relative z-10">
        <div
          class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1"
        >
          Wind
        </div>
        <div class="text-3xl font-bold text-gray-900 dark:text-white">
          {% if current %}{{ "%.1f"|format(current.wind_speed_ms) }} m/s{% else
          %}--{% endif %}
        </div>
        <div class="text-xs text-gray-500 mt-1">
          Cloud Cover: {% if current %}{{
          "%.0f"|format(current.cloud_cover_percent) }}%{% else %}--{% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div
    class="glass-panel p-6 rounded-2xl border border-gray-200 dark:border-white/5"
  >
    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-6">
      24h History
    </h3>
    <div class="relative h-64 w-full">
      <canvas id="weatherChart"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Initialize Chart
  const ctx = document.getElementById('weatherChart').getContext('2d');

  // Gradient for Temp
  const gradientTemp = ctx.createLinearGradient(0, 0, 0, 300);
  gradientTemp.addColorStop(0, 'rgba(239, 68, 68, 0.5)'); // Red-500
  gradientTemp.addColorStop(1, 'rgba(239, 68, 68, 0.0)');

  const weatherChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: {{ history.labels | tojson }},
          datasets: [
              {
                  label: 'Temperature (¬∞C)',
                  data: {{ history.temp | tojson }},
                  borderColor: '#ef4444', // Red
                  backgroundColor: gradientTemp,
                  borderWidth: 2,
                  tension: 0.4,
                  fill: true,
                  yAxisID: 'y'
              },
              {
                  label: 'Humidity (%)',
                  data: {{ history.humidity | tojson }},
                  borderColor: '#3b82f6', // Blue
                  borderWidth: 2,
                  tension: 0.4,
                  pointRadius: 0,
                  yAxisID: 'y1'
              }
          ]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
              mode: 'index',
              intersect: false,
          },
          plugins: {
              legend: {
                  labels: { color: '#9ca3af' }
              }
          },
          scales: {
              x: {
                  grid: { color: 'rgba(255, 255, 255, 0.1)' },
                  ticks: { color: '#9ca3af', maxTicksLimit: 8 }
              },
              y: {
                  type: 'linear',
                  display: true,
                  position: 'left',
                  grid: { color: 'rgba(255, 255, 255, 0.1)' },
                  ticks: { color: '#ef4444' }
              },
              y1: {
                  type: 'linear',
                  display: true,
                  position: 'right',
                  grid: { drawOnChartArea: false },
                  ticks: { color: '#3b82f6' }
              }
          }
      }
  });
</script>
{% endblock %} {% block inspector %}
<div class="flex flex-col h-full">
  <div class="p-4 border-b border-gray-200 dark:border-white/10">
    <h3
      class="font-bold text-gray-900 dark:text-white uppercase tracking-wider text-xs"
    >
      Weather Details
    </h3>
  </div>
  <div class="p-4 space-y-4">
    {% if current %}
    <div>
      <div class="text-xs text-gray-500 uppercase">Station ID</div>
      <div class="font-mono text-sm dark:text-gray-300">
        {{ current.station_id }}
      </div>
    </div>
    <div>
      <div class="text-xs text-gray-500 uppercase">Last Update</div>
      <div class="font-mono text-sm dark:text-gray-300">
        {{ current.timestamp.strftime('%H:%M:%S') if current.timestamp else '-'
        }}
      </div>
    </div>
    <div>
      <div class="text-xs text-gray-500 uppercase">Conditions</div>
      <div class="text-sm dark:text-gray-300">
        {% if current.precipitation_mm > 0 %} Raining ({{
        current.precipitation_mm }}mm) {% elif current.cloud_cover_percent > 80
        %} Overcast {% elif current.cloud_cover_percent > 50 %} Cloudy {% else
        %} Clear/Partly Coudy {% endif %}
      </div>
    </div>
    {% else %}
    <div class="text-sm text-gray-500">No data available</div>
    {% endif %}
  </div>
</div>
{% endblock %}
