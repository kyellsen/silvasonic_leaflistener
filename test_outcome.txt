============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /mnt/data/dev/packages/silvasonic
configfile: pyproject.toml
plugins: cov-7.0.0
collected 42 items

containers/controller/tests/test_device_manager.py ......                [ 14%]
containers/controller/tests/test_main.py ...............                 [ 50%]
containers/controller/tests/test_podman_client.py ...F..F.               [ 69%]
containers/controller/tests/test_profiles_loader.py .............        [100%]

=================================== FAILURES ===================================
_____________________________ test_spawn_recorder ______________________________

    def test_spawn_recorder():
        orc = PodmanOrchestrator()
    
        with patch("subprocess.run") as mock_run:
            mock_run.return_value.returncode = 0
    
            success = orc.spawn_recorder(
                name="test_mic",
                profile_slug="rode_nt",
                device_path="/dev/snd/pcmC1D0c",
                card_id="1"
            )
            assert success
    
            # Verify call arguments
            args = mock_run.call_args[0][0]
            assert "podman" in args
            assert "run" in args
            assert "--device" in args
            # Check if port is calculated correctly (12000 + 1)
            assert any("LIVE_STREAM_PORT=12001" in a for a in args)
    
            success = orc.spawn_recorder("mic", "slug", "path", "1")
>           assert not success
E           assert not True

containers/controller/tests/test_podman_client.py:56: AssertionError
_____________________________ test_spawn_exception _____________________________

    def test_spawn_exception():
        orc = PodmanOrchestrator()
        with patch("subprocess.run", side_effect=Exception("Boom")):
>           assert not orc.spawn_recorder("mic", "s", "p", "1") is False
E           AssertionError: assert not False is False
E            +  where False = spawn_recorder('mic', 's', 'p', '1')
E            +    where spawn_recorder = <silvasonic_controller.podman_client.PodmanOrchestrator object at 0x7f6380edbd40>.spawn_recorder

containers/controller/tests/test_podman_client.py:81: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    PodmanClient:podman_client.py:128 Spawn Exception: Boom
=========================== short test summary info ============================
FAILED containers/controller/tests/test_podman_client.py::test_spawn_recorder
FAILED containers/controller/tests/test_podman_client.py::test_spawn_exception
========================= 2 failed, 40 passed in 0.07s =========================
